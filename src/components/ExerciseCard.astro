---
const {
	id,
	sectionId,
	name,
	image,
	sets,
	reps,
	rest,
	restSeconds,
	cues = [],
	easyVariant,
	hardVariant,
	order,
} = Astro.props;
---

<article
	class="exercise-card"
	data-exercise-id={id}
	data-section-id={sectionId}
	data-rest={restSeconds}
>
	<div class="exercise-card__image">
		<img src={image} alt={`Ejercicio: ${name}`} loading="lazy" />
		{order && <span class="exercise-card__order">#{order}</span>}
	</div>
	<div class="exercise-card__content">
		<div class="exercise-card__title">
			<h3>{name}</h3>
			<label class="exercise-card__check">
				<input type="checkbox" data-done-checkbox />
				<span>Hecho</span>
			</label>
		</div>
		<dl class="exercise-card__meta">
			<div>
				<dt>Series</dt>
				<dd>{sets}</dd>
			</div>
			<div>
				<dt>Repeticiones/Tiempo</dt>
				<dd>{reps}</dd>
			</div>
			<div>
				<dt>Descanso</dt>
				<dd>{rest}</dd>
			</div>
		</dl>
		<div class="exercise-card__timer" data-timer>
			<div class="exercise-card__timer-row">
				<p class="exercise-card__timer-label">Descanso</p>
				<div class="exercise-card__timer-display" data-timer-display>00:00</div>
			</div>
			<div class="exercise-card__timer-options">
				<button type="button" data-rest-option="20">20s</button>
				<button type="button" data-rest-option="45">45s</button>
				<button type="button" data-rest-option="60">60s</button>
				<button type="button" data-rest-option="90">90s</button>
			</div>
			<div class="exercise-card__timer-actions">
				<button type="button" data-action="start">Iniciar descanso</button>
				<button type="button" data-action="toggle" disabled>Pausar</button>
				<button type="button" data-action="reset" disabled>Reset</button>
				<button type="button" data-action="next">Siguiente</button>
			</div>
			<div class="exercise-card__timer-status" data-timer-status aria-live="polite"></div>
			<button class="exercise-card__done-cta" type="button" data-action="mark-done" hidden>
				Marcar como hecho
			</button>
		</div>
		{cues?.length > 0 && (
			<div class="exercise-card__cues">
				<h4>Pistas tecnicas</h4>
				<ul>
					{cues.map((cue) => (
						<li>{cue}</li>
					))}
				</ul>
			</div>
		)}
		{(easyVariant || hardVariant) && (
			<div class="exercise-card__variants">
				<h4>Variantes</h4>
				<ul>
					{easyVariant && (
						<li>
							<strong>Facil:</strong> {easyVariant}
						</li>
					)}
					{hardVariant && (
						<li>
							<strong>Dificil:</strong> {hardVariant}
						</li>
					)}
				</ul>
			</div>
		)}
	</div>
</article>

<style>
	.exercise-card {
		display: grid;
		grid-template-rows: auto 1fr;
		background: linear-gradient(160deg, rgba(27, 35, 51, 0.95), rgba(15, 19, 30, 0.95));
		border: 1px solid rgba(148, 163, 184, 0.15);
		border-radius: 18px;
		overflow: hidden;
		box-shadow: 0 18px 40px rgba(6, 10, 18, 0.45);
	}

	.exercise-card__image {
		position: relative;
		aspect-ratio: 16 / 9;
		overflow: hidden;
	}

	.exercise-card__image img {
		width: 100%;
		height: 100%;
		object-fit: cover;
		filter: saturate(1.05);
	}

	.exercise-card__order {
		position: absolute;
		top: 0.85rem;
		right: 0.85rem;
		background: rgba(15, 23, 42, 0.85);
		border: 1px solid rgba(148, 163, 184, 0.25);
		color: #facc15;
		padding: 0.3rem 0.6rem;
		border-radius: 999px;
		font-size: 0.8rem;
		letter-spacing: 0.05em;
	}

	.exercise-card__content {
		padding: 1.25rem 1.35rem 1.5rem;
		display: grid;
		gap: 1rem;
	}

	.exercise-card__title {
		display: flex;
		align-items: center;
		justify-content: space-between;
		gap: 1rem;
		flex-wrap: wrap;
	}

	.exercise-card h3 {
		font-size: 1.25rem;
		margin: 0;
		color: #f8fafc;
	}

	.exercise-card__check {
		display: inline-flex;
		align-items: center;
		gap: 0.4rem;
		font-size: 0.9rem;
		color: rgba(226, 232, 240, 0.8);
	}

	.exercise-card__check input {
		width: 1.1rem;
		height: 1.1rem;
		accent-color: #facc15;
	}

	.exercise-card.is-done {
		border-color: rgba(34, 197, 94, 0.5);
		box-shadow: 0 16px 36px rgba(15, 23, 42, 0.65);
		opacity: 0.82;
	}

	.exercise-card.is-done h3 {
		text-decoration: line-through;
		text-decoration-thickness: 2px;
		color: rgba(226, 232, 240, 0.6);
	}

	.exercise-card__meta {
		display: grid;
		grid-template-columns: repeat(3, minmax(0, 1fr));
		gap: 0.75rem;
		margin: 0;
	}

	.exercise-card__meta div {
		background: rgba(15, 23, 42, 0.6);
		border-radius: 12px;
		padding: 0.65rem 0.75rem;
		border: 1px solid rgba(148, 163, 184, 0.15);
	}

	.exercise-card__meta dt {
		font-size: 0.7rem;
		text-transform: uppercase;
		letter-spacing: 0.06em;
		color: rgba(226, 232, 240, 0.7);
	}

	.exercise-card__meta dd {
		margin: 0.25rem 0 0;
		font-weight: 600;
		font-size: 0.95rem;
		color: #e2e8f0;
	}

	.exercise-card__timer {
		background: rgba(8, 12, 20, 0.75);
		border: 1px solid rgba(148, 163, 184, 0.2);
		border-radius: 14px;
		padding: 0.9rem;
		display: grid;
		gap: 0.75rem;
	}

	.exercise-card__timer-row {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 1rem;
	}

	.exercise-card__timer-label {
		margin: 0;
		font-size: 0.9rem;
		color: rgba(226, 232, 240, 0.7);
	}

	.exercise-card__timer-display {
		font-weight: 700;
		font-size: 1.1rem;
		color: #f8fafc;
		letter-spacing: 0.08em;
	}

	.exercise-card__timer-options {
		display: grid;
		grid-template-columns: repeat(4, minmax(0, 1fr));
		gap: 0.5rem;
	}

	.exercise-card__timer-options button,
	.exercise-card__timer-actions button,
	.exercise-card__done-cta {
		background: rgba(15, 23, 42, 0.7);
		border: 1px solid rgba(148, 163, 184, 0.2);
		color: rgba(226, 232, 240, 0.9);
		border-radius: 10px;
		padding: 0.45rem 0.6rem;
		font-size: 0.85rem;
		cursor: pointer;
		transition: border-color 0.2s ease, transform 0.2s ease;
	}

	.exercise-card__timer-options button.is-active {
		border-color: rgba(250, 204, 21, 0.7);
		color: #facc15;
	}

	.exercise-card__timer-actions {
		display: grid;
		grid-template-columns: repeat(2, minmax(0, 1fr));
		gap: 0.5rem;
	}

	.exercise-card__timer-actions button[data-action='start'] {
		background: rgba(250, 204, 21, 0.15);
		border-color: rgba(250, 204, 21, 0.5);
		color: #facc15;
	}

	.exercise-card__timer-actions button:disabled {
		opacity: 0.5;
		cursor: not-allowed;
	}

	.exercise-card__timer-status {
		min-height: 1.1rem;
		font-size: 0.85rem;
		color: rgba(226, 232, 240, 0.7);
	}

	.exercise-card__timer.is-complete .exercise-card__timer-display {
		color: #22c55e;
	}

	.exercise-card__done-cta {
		background: rgba(34, 197, 94, 0.2);
		border-color: rgba(34, 197, 94, 0.5);
		color: #bbf7d0;
	}

	.exercise-card__timer-options button:focus-visible,
	.exercise-card__timer-actions button:focus-visible,
	.exercise-card__done-cta:focus-visible {
		outline: 2px solid #facc15;
		outline-offset: 2px;
	}

	.exercise-card__cues,
	.exercise-card__variants {
		background: rgba(15, 23, 42, 0.35);
		border: 1px solid rgba(148, 163, 184, 0.12);
		border-radius: 12px;
		padding: 0.75rem 0.9rem;
	}

	.exercise-card__cues h4,
	.exercise-card__variants h4 {
		margin: 0 0 0.35rem;
		font-size: 0.95rem;
		color: #e2e8f0;
	}

	.exercise-card__cues ul,
	.exercise-card__variants ul {
		margin: 0;
		padding-left: 1.1rem;
		color: rgba(226, 232, 240, 0.85);
		font-size: 0.95rem;
		display: grid;
		gap: 0.25rem;
	}

	.exercise-card__variants strong {
		color: #facc15;
	}

	@media (max-width: 640px) {
		.exercise-card__meta {
			grid-template-columns: 1fr;
		}

		.exercise-card__timer-options {
			grid-template-columns: repeat(2, minmax(0, 1fr));
		}
	}
</style>
