---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import RoutineClient from '../components/RoutineClient.astro';
import RoutineCustomizer from '../components/RoutineCustomizer.astro';
import RoutineFloating from '../components/RoutineFloating.astro';
import RoutineHero from '../components/RoutineHero.astro';
import RoutineInfoPanels from '../components/RoutineInfoPanels.astro';
import RoutineOverlays from '../components/RoutineOverlays.astro';
import RoutineOverview from '../components/RoutineOverview.astro';
import RoutineSections from '../components/RoutineSections.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { routineSections } from '../data/routine';

const getDefaultRest = (rest) => {
	const match = rest.match(/\d+/);
	return match ? Number(match[0]) : 30;
};

const routineSummary = routineSections.map((section) => ({
	id: section.id,
	title: section.title,
	count: section.exercises.length,
}));

const totalExercises = routineSections.reduce((sum, section) => sum + section.exercises.length, 0);
---

<!doctype html>
<html lang="es">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main class="mx-auto flex w-full max-w-6xl flex-col gap-12 px-6 pb-20 pt-10">
			<RoutineHero totalExercises={totalExercises} />
			<RoutineOverview routineSummary={routineSummary} totalExercises={totalExercises} />
			<RoutineCustomizer sections={routineSections} />
			<RoutineInfoPanels />
			<RoutineSections sections={routineSections} getDefaultRest={getDefaultRest} />

			<section class="glass-panel flex flex-col gap-4 p-6">
				<h2 class="font-display text-xl text-slate-100">Salida limpia</h2>
				<p class="text-sm text-slate-300">
					Has terminado? Guarda tu perfil y vuelve cuando quieras continuar tu progreso.
				</p>
				<a
					href="/profile"
					class="w-fit rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
				>
					Ir al perfil
				</a>
			</section>
		</main>

		<RoutineFloating routineSummary={routineSummary} />
		<RoutineOverlays />
		<Footer />
		<RoutineClient />
	</body>
</html>
