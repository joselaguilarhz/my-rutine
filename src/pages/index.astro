---
import BaseHead from '../components/BaseHead.astro';
import ExerciseCard from '../components/ExerciseCard.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import RoutineClient from '../components/RoutineClient.astro';
import Section from '../components/Section.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const getDefaultRest = (rest) => {
	const match = rest.match(/\d+/);
	return match ? Number(match[0]) : 30;
};

const routineSections = [
	{
		id: 'calentamiento',
		title: 'Calentamiento',
		description: 'Activa articulaciones y sube pulsaciones antes de empezar.',
		exercises: [
			{
				id: 'calentamiento-jumping-jacks',
				name: 'Jumping Jacks',
				image: '/exercises/jumping-jack.jpg',
				sets: '2',
				reps: '30 s',
				rest: '20 s',
				cues: ['Aterriza suave', 'Brazos energicos y coordinados'],
				easyVariant: 'Reduce el ritmo o el rango del salto',
				hardVariant: 'Aumenta la velocidad durante los ultimos 10 s',
			},
			{
				id: 'calentamiento-movilidad-hombros',
				name: 'Movilidad hombros',
				image: '/exercises/pike-push-up.jpg',
				sets: '2',
				reps: '20 rotaciones',
				rest: '15 s',
				cues: ['Movimiento amplio y controlado', 'Sin dolor ni compensaciones'],
			},
			{
				id: 'calentamiento-sentadilla-suave',
				name: 'Sentadillas suaves',
				image: '/exercises/squat.jpg',
				sets: '2',
				reps: '15',
				rest: '30 s',
				cues: ['Talones pegados al suelo', 'Espalda neutra y pecho abierto'],
			},
		],
	},
	{
		id: 'piernas',
		title: 'Piernas y gluteos',
		description: 'Fuerza base y estabilidad para todo el cuerpo.',
		exercises: [
			{
				id: 'piernas-sentadillas',
				name: 'Sentadillas',
				image: '/exercises/squat.jpg',
				sets: '3',
				reps: '15',
				rest: '60 s',
				cues: ['Rodillas alineadas con pies', 'Baja controlado'],
				easyVariant: 'Menor rango de movimiento',
				hardVariant: 'Pausa de 2 s abajo',
			},
			{
				id: 'piernas-zancadas-alternas',
				name: 'Zancadas alternas',
				image: '/exercises/lunge.jpg',
				sets: '3',
				reps: '10 por pierna',
				rest: '60 s',
				cues: ['Paso largo', 'Torso erguido'],
				easyVariant: 'Apoyate en una pared',
				hardVariant: 'Anade un salto al cambio',
			},
			{
				id: 'piernas-puente-gluteo',
				name: 'Puente de gluteo',
				image: '/exercises/glute-bridge.jpg',
				sets: '3',
				reps: '15',
				rest: '45 s',
				cues: ['Empuja con talones', 'Aprieta gluteos arriba'],
				easyVariant: 'Eleva menos altura',
				hardVariant: 'Una pierna alternando',
			},
			{
				id: 'piernas-wall-sit',
				name: 'Wall sit',
				image: '/exercises/wall-sit.jpg',
				sets: '3',
				reps: '30-45 s',
				rest: '60 s',
				cues: ['Rodillas a 90 grados', 'Espalda pegada a la pared'],
				easyVariant: 'Manten 20 s',
				hardVariant: 'Sujeta una mochila en el pecho',
			},
		],
	},
	{
		id: 'empuje',
		title: 'Empuje (pecho, hombro, triceps)',
		description: 'Trabajo de empuje para la parte superior.',
		exercises: [
			{
				id: 'empuje-flexiones',
				name: 'Flexiones',
				image: '/exercises/push-up.jpg',
				sets: '3',
				reps: '8-15',
				rest: '60-90 s',
				cues: ['Cuerpo en linea recta', 'Codos a 45 grados'],
				easyVariant: 'Apoya rodillas',
				hardVariant: 'Pies elevados',
			},
			{
				id: 'empuje-flexiones-pica',
				name: 'Flexiones pica (hombros)',
				image: '/exercises/pike-push-up.jpg',
				sets: '3',
				reps: '10',
				rest: '60 s',
				cues: ['Cadera arriba', 'Baja la cabeza entre manos'],
				easyVariant: 'Menos inclinacion',
				hardVariant: 'Pies sobre una silla',
			},
			{
				id: 'empuje-fondos-silla',
				name: 'Fondos en silla',
				image: '/exercises/chair-dip.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Hombros atras', 'Baja hasta 90 grados'],
				easyVariant: 'Rodillas flexionadas',
				hardVariant: 'Piernas estiradas',
			},
		],
	},
	{
		id: 'tiron',
		title: 'Tiron (espalda, biceps)',
		description: 'Compensa el empuje y activa la espalda.',
		exercises: [
			{
				id: 'tiron-remo-mochila',
				name: 'Remo con mochila',
				image: '/exercises/backpack-row.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Espalda recta', 'Codos cerca del torso'],
				easyVariant: 'Menos peso en la mochila',
				hardVariant: 'Pausa 1 s arriba',
			},
			{
				id: 'tiron-curl-biceps',
				name: 'Curl biceps con mochila/garrafas',
				image: '/exercises/backpack-curl.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Codos fijos', 'Controla la bajada'],
				easyVariant: 'Menos peso',
				hardVariant: 'Subida de 3 s',
			},
		],
	},
	{
		id: 'core',
		title: 'Core (abdominales)',
		description: 'Estabilidad y control del tronco.',
		exercises: [
			{
				id: 'core-plancha',
				name: 'Plancha',
				image: '/exercises/plank.jpg',
				sets: '3',
				reps: '30-45 s',
				rest: '45 s',
				cues: ['Abdomen activo', 'Cadera alineada'],
				easyVariant: 'Apoya rodillas',
				hardVariant: 'Eleva una pierna',
			},
			{
				id: 'core-crunch',
				name: 'Crunch',
				image: '/exercises/crunch.jpg',
				sets: '3',
				reps: '15',
				rest: '30 s',
				cues: ['No jales el cuello', 'Exhala al subir'],
				easyVariant: 'Menos rango',
				hardVariant: 'Pausa 1 s arriba',
			},
			{
				id: 'core-elevaciones-piernas',
				name: 'Elevaciones de piernas',
				image: '/exercises/leg-raise.jpg',
				sets: '3',
				reps: '12',
				rest: '45 s',
				cues: ['Espalda baja pegada', 'Baja lento'],
				easyVariant: 'Rodillas flexionadas',
				hardVariant: 'Anade tobilleras',
			},
		],
	},
	{
		id: 'finisher',
		title: 'Finisher (opcional)',
		description: 'Cierra con cardio y potencia.',
		exercises: [
			{
				id: 'finisher-mountain-climbers',
				name: 'Mountain climbers',
				image: '/exercises/mountain-climber.jpg',
				sets: '3',
				reps: '30 s',
				rest: '30 s',
				cues: ['Ritmo constante', 'Cadera estable'],
				easyVariant: 'Ritmo lento',
				hardVariant: 'Sprint final de 10 s',
			},
			{
				id: 'finisher-jumping-jacks',
				name: 'Jumping Jacks',
				image: '/exercises/jumping-jack.jpg',
				sets: '3',
				reps: '30 s',
				rest: '20 s',
				cues: ['Respira profundo', 'Aterriza suave'],
			},
		],
	},
];

const routineSummary = routineSections.map((section) => ({
	id: section.id,
	title: section.title,
	count: section.exercises.length,
}));

const totalExercises = routineSections.reduce((sum, section) => sum + section.exercises.length, 0);
---

<!doctype html>
<html lang="es">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<main class="mx-auto flex w-full max-w-6xl flex-col gap-12 px-6 pb-20 pt-10">
			<section class="grid gap-8 lg:grid-cols-[1.1fr,0.9fr]">
				<div class="flex flex-col gap-6">
					<p class="inline-flex w-fit items-center gap-2 rounded-full border border-amber-300/30 bg-amber-300/10 px-4 py-2 text-xs font-semibold uppercase tracking-[0.35em] text-amber-300">
						Rutina full body en casa
					</p>
					<h1 class="font-display text-3xl leading-tight text-slate-50 md:text-5xl">
						Entrena todo el cuerpo con ritmo y control
					</h1>
					<p class="max-w-2xl text-base text-slate-300">
						Una experiencia de rutina guiada para casa: marca avances, controla descansos y
						manten el flujo sin perder foco.
					</p>
					<div class="flex flex-wrap gap-3 text-xs uppercase tracking-[0.25em] text-slate-400">
						<span class="rounded-full border border-slate-700/50 bg-slate-900/80 px-3 py-1">45-60 min</span>
						<span class="rounded-full border border-slate-700/50 bg-slate-900/80 px-3 py-1">Sin gimnasio</span>
						<span class="rounded-full border border-slate-700/50 bg-slate-900/80 px-3 py-1">Material opcional</span>
					</div>
					<div class="flex flex-wrap gap-3">
						<a
							href="#calentamiento"
							class="rounded-full bg-amber-300 px-6 py-3 text-xs font-semibold uppercase tracking-[0.3em] text-slate-950"
						>
							Comenzar
						</a>
						<a
							href="#finisher"
							class="rounded-full border border-slate-700/60 bg-slate-900/70 px-6 py-3 text-xs font-semibold uppercase tracking-[0.3em] text-slate-200"
						>
							Ver cierre
						</a>
					</div>
				</div>
				<div class="glass-panel flex flex-col gap-4 p-6">
					<h2 class="font-display text-xl text-slate-100">Tu sesion de hoy</h2>
					<p class="text-sm text-slate-300">
						Completa cada bloque y marca el avance para ver el progreso en tiempo real.
					</p>
					<div class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-400">
						<span>Total ejercicios</span>
						<span>{totalExercises}</span>
					</div>
					<div class="flex items-center justify-between text-xs uppercase tracking-[0.25em] text-slate-400">
						<span>Descanso recomendado</span>
						<span>45-60 s</span>
					</div>
					<div class="rounded-xl border border-slate-700/40 bg-slate-950/70 p-4 text-sm text-slate-300">
						Empieza con el calentamiento completo y descansa 1-2 min entre secciones si lo necesitas.
					</div>
				</div>
			</section>

			<section class="grid gap-6 md:grid-cols-[1.2fr,0.8fr]">
				<div class="glass-panel flex flex-col gap-4 p-6">
					<h2 class="font-display text-lg text-slate-100">Indice de secciones</h2>
					<div class="grid gap-2">
						{routineSummary.map((item) => (
							<a
								href={`#${item.id}`}
								class="flex items-center justify-between rounded-xl border border-slate-700/40 bg-slate-950/60 px-4 py-3 text-sm text-slate-200"
							>
								<span>{item.title}</span>
								<em class="text-xs not-italic uppercase tracking-[0.2em] text-slate-400">
									{item.count} ejercicios
								</em>
							</a>
						))}
					</div>
				</div>
				<section class="glass-panel flex flex-col gap-4 p-6" aria-live="polite">
					<h2 class="font-display text-lg text-slate-100">Progreso de hoy</h2>
					<p class="text-sm text-slate-300">
						<span data-progress-count>0</span> / <span data-progress-total>{totalExercises}</span> ejercicios
						completados
					</p>
					<div class="h-2 w-full overflow-hidden rounded-full bg-slate-900">
						<div class="h-full w-0 bg-gradient-to-r from-amber-300 to-emerald-400" data-progress-fill></div>
					</div>
					<div class="flex flex-wrap items-center gap-3">
						<button
							class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
							type="button"
							data-reset-today
						>
							Reset de hoy
						</button>
						<label class="inline-flex items-center gap-2 text-xs uppercase tracking-[0.2em] text-slate-400">
							<input type="checkbox" data-filter-pending class="h-4 w-4 rounded border-slate-600" />
							Solo pendientes
						</label>
						<button
							class="rounded-full border border-amber-300/50 bg-amber-300/10 px-4 py-2 text-xs uppercase tracking-[0.25em] text-amber-300"
							type="button"
							data-guided-toggle
						>
							Modo guiado
						</button>
					</div>
					<div class="flex flex-wrap items-center gap-3 text-xs uppercase tracking-[0.2em] text-slate-400">
						<label class="inline-flex items-center gap-2">
							<input type="checkbox" data-sound-toggle class="h-4 w-4 rounded border-slate-600" />
							Sonido
						</label>
						<label class="inline-flex items-center gap-2">
							<input type="checkbox" data-vibration-toggle class="h-4 w-4 rounded border-slate-600" />
							Vibracion
						</label>
					</div>
				</section>
			</section>

			<section class="grid gap-6 lg:grid-cols-3">
				<div class="glass-panel flex flex-col gap-3 p-5">
					<h3 class="font-display text-base text-slate-100">Equipo y espacio</h3>
					<p class="text-sm text-slate-300">Silla estable, mochila con peso y colchoneta.</p>
					<ul class="grid gap-1 text-sm text-slate-400">
						<li>Mochila: libros o botellas.</li>
						<li>Espacio: 2x2 metros libres.</li>
						<li>Suelo antideslizante.</li>
					</ul>
				</div>
				<div class="glass-panel flex flex-col gap-3 p-5">
					<h3 class="font-display text-base text-slate-100">Frecuencia sugerida</h3>
					<p class="text-sm text-slate-300">2-4 sesiones por semana segun tu nivel.</p>
					<ul class="grid gap-1 text-sm text-slate-400">
						<li>Principiante: 2 dias.</li>
						<li>Intermedio: 3 dias.</li>
						<li>Avanzado: 4 dias.</li>
					</ul>
				</div>
				<div class="glass-panel flex flex-col gap-3 p-5">
					<h3 class="font-display text-base text-slate-100">Cierre y estiramiento</h3>
					<p class="text-sm text-slate-300">Baja pulsaciones y recupera mejor.</p>
					<ul class="grid gap-1 text-sm text-slate-400">
						<li>Respiracion profunda.</li>
						<li>Estira piernas y espalda.</li>
						<li>Hidrata y registra progreso.</li>
					</ul>
				</div>
			</section>

			<section class="flex flex-col gap-10">
				{routineSections.map((section) => (
					<Section
						id={section.id}
						title={section.title}
						description={section.description}
						count={section.exercises.length}
					>
						{section.exercises.map((exercise, index) => (
							<ExerciseCard
								{...exercise}
								order={index + 1}
								sectionId={section.id}
								restSeconds={getDefaultRest(exercise.rest)}
							/>
						))}
					</Section>
				))}
			</section>

			<section class="glass-panel flex flex-col gap-4 p-6">
				<h2 class="font-display text-xl text-slate-100">Salida limpia</h2>
				<p class="text-sm text-slate-300">
					Has terminado? Guarda tu perfil y vuelve cuando quieras continuar tu progreso.
				</p>
				<a
					href="/profile"
					class="w-fit rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
				>
					Ir al perfil
				</a>
			</section>
		</main>

		<button
			class="fixed bottom-6 left-6 z-20 inline-flex rounded-full border border-slate-700/60 bg-slate-900/80 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200 md:hidden"
			type="button"
			data-sections-toggle
			aria-expanded="false"
		>
			Secciones
		</button>
		<div
			class="fixed inset-0 z-10 bg-slate-950/70 opacity-0 pointer-events-none transition"
			data-sections-overlay
		></div>
		<div
			class="fixed bottom-20 left-6 z-20 hidden w-[min(260px,calc(100vw-3rem))] flex flex-col gap-4 rounded-2xl border border-slate-700/50 bg-slate-950/95 p-4"
			data-sections-panel
			hidden
		>
			<h3 class="text-sm font-semibold uppercase tracking-[0.2em] text-slate-300">Ir a seccion</h3>
			<nav class="grid gap-2 text-sm text-slate-200">
				{routineSummary.map((item) => (
					<a class="rounded-xl bg-slate-900/70 px-3 py-2" href={`#${item.id}`}>
						{item.title}
					</a>
				))}
			</nav>
		</div>
		<button
			class="fixed bottom-6 right-6 z-20 rounded-full bg-amber-300 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-950 opacity-0 pointer-events-none transition"
			type="button"
			data-back-to-top
			aria-label="Volver arriba"
		>
			Arriba
		</button>
		<div
			class="fixed bottom-0 left-0 right-0 z-20 hidden border-t border-slate-800/60 bg-slate-950/90 px-6 py-4 backdrop-blur"
			data-now-playing
		>
			<div class="mx-auto flex w-full max-w-6xl flex-col gap-3 md:flex-row md:items-center md:justify-between">
				<div>
					<p class="text-xs uppercase tracking-[0.3em] text-slate-400">Ahora</p>
					<p class="text-lg font-semibold text-slate-100" data-now-title>Selecciona un ejercicio</p>
					<p class="text-xs uppercase tracking-[0.3em] text-amber-300" data-now-timer>00:00</p>
				</div>
				<div class="flex flex-wrap gap-2">
					<button
						class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
						type="button"
						data-now-start
					>
						Iniciar descanso
					</button>
					<button
						class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
						type="button"
						data-now-toggle
					>
						Pausar
					</button>
					<button
						class="rounded-full border border-amber-300/50 bg-amber-300/10 px-4 py-2 text-xs uppercase tracking-[0.25em] text-amber-300"
						type="button"
						data-now-done
					>
						Hecho
					</button>
					<button
						class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.25em] text-slate-200"
						type="button"
						data-now-next
					>
						Siguiente
					</button>
				</div>
			</div>
		</div>
		<div class="fixed right-6 top-24 z-30 grid gap-2" data-toast-container></div>
		<div
			class="fixed inset-0 z-40 hidden bg-slate-950/95 text-slate-100"
			data-guided-overlay
			aria-hidden="true"
		>
			<div class="relative h-full w-full">
				<button
					type="button"
					class="absolute right-6 top-6 rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.2em] text-slate-200"
					data-guided-close
				>
					Salir
				</button>
				<div class="mx-auto flex h-full w-full max-w-3xl flex-col gap-4 px-6 py-10">
					<div class="flex items-center gap-3 text-xs uppercase tracking-[0.3em] text-slate-400">
						<span>Modo guiado</span>
						<span data-guided-index>1/1</span>
					</div>
					<div class="relative flex-1 overflow-hidden rounded-3xl border border-slate-700/60">
						<img
							data-guided-image
							src=""
							alt=""
							class="h-full w-full object-cover"
						/>
						<div class="absolute inset-0 bg-gradient-to-b from-slate-950/70 via-transparent to-slate-950/80"></div>
						<div class="absolute left-0 top-0 h-full w-2 bg-slate-900/70">
							<div class="h-0 w-full bg-amber-300" data-guided-progress></div>
						</div>
						<div class="absolute bottom-0 left-0 right-0 flex flex-col gap-3 p-6">
							<h2 class="font-display text-3xl text-slate-50" data-guided-title></h2>
							<p class="text-sm text-slate-300" data-guided-meta></p>
							<div class="flex items-center justify-between">
								<span class="text-xs uppercase tracking-[0.3em] text-amber-300">Descanso</span>
								<span class="text-lg font-semibold tracking-[0.3em] text-amber-300" data-guided-timer>
									00:00
								</span>
							</div>
							<div class="grid grid-cols-2 gap-2 md:grid-cols-4">
								<button
									type="button"
									class="rounded-full bg-amber-300 px-4 py-2 text-xs font-semibold uppercase tracking-[0.2em] text-slate-950"
									data-guided-start
								>
									Iniciar
								</button>
								<button
									type="button"
									class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.2em] text-slate-200"
									data-guided-next
								>
									Siguiente
								</button>
								<button
									type="button"
									class="rounded-full border border-amber-300/50 bg-amber-300/10 px-4 py-2 text-xs uppercase tracking-[0.2em] text-amber-300"
									data-guided-done
								>
									Hecho
								</button>
								<button
									type="button"
									class="rounded-full border border-slate-700/60 bg-slate-900/70 px-4 py-2 text-xs uppercase tracking-[0.2em] text-slate-200"
									data-guided-pause
								>
									Pausar
								</button>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<Footer />
		<RoutineClient />
	</body>
</html>
