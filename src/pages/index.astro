---
import BaseHead from '../components/BaseHead.astro';
import ExerciseCard from '../components/ExerciseCard.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import RoutineClient from '../components/RoutineClient.astro';
import Section from '../components/Section.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';

const getDefaultRest = (rest) => {
	const match = rest.match(/\d+/);
	return match ? Number(match[0]) : 30;
};

const routineSections = [
	{
		id: 'calentamiento',
		title: 'Calentamiento',
		description: 'Activa articulaciones y sube pulsaciones antes de empezar.',
		exercises: [
			{
				id: 'calentamiento-jumping-jacks',
				name: 'Jumping Jacks',
				image: '/exercises/jumping-jack.jpg',
				sets: '2',
				reps: '30 s',
				rest: '20 s',
				cues: ['Aterriza suave', 'Brazos energicos y coordinados'],
				easyVariant: 'Reduce el ritmo o el rango del salto',
				hardVariant: 'Aumenta la velocidad durante los ultimos 10 s',
			},
			{
				id: 'calentamiento-movilidad-hombros',
				name: 'Movilidad hombros',
				image: '/exercises/pike-push-up.jpg',
				sets: '2',
				reps: '20 rotaciones',
				rest: '15 s',
				cues: ['Movimiento amplio y controlado', 'Sin dolor ni compensaciones'],
			},
			{
				id: 'calentamiento-sentadilla-suave',
				name: 'Sentadillas suaves',
				image: '/exercises/squat.jpg',
				sets: '2',
				reps: '15',
				rest: '30 s',
				cues: ['Talones pegados al suelo', 'Espalda neutra y pecho abierto'],
			},
		],
	},
	{
		id: 'piernas',
		title: 'Piernas y gluteos',
		description: 'Fuerza base y estabilidad para todo el cuerpo.',
		exercises: [
			{
				id: 'piernas-sentadillas',
				name: 'Sentadillas',
				image: '/exercises/squat.jpg',
				sets: '3',
				reps: '15',
				rest: '60 s',
				cues: ['Rodillas alineadas con pies', 'Baja controlado'],
				easyVariant: 'Menor rango de movimiento',
				hardVariant: 'Pausa de 2 s abajo',
			},
			{
				id: 'piernas-zancadas-alternas',
				name: 'Zancadas alternas',
				image: '/exercises/lunge.jpg',
				sets: '3',
				reps: '10 por pierna',
				rest: '60 s',
				cues: ['Paso largo', 'Torso erguido'],
				easyVariant: 'Apoyate en una pared',
				hardVariant: 'Anade un salto al cambio',
			},
			{
				id: 'piernas-puente-gluteo',
				name: 'Puente de gluteo',
				image: '/exercises/glute-bridge.jpg',
				sets: '3',
				reps: '15',
				rest: '45 s',
				cues: ['Empuja con talones', 'Aprieta gluteos arriba'],
				easyVariant: 'Eleva menos altura',
				hardVariant: 'Una pierna alternando',
			},
			{
				id: 'piernas-wall-sit',
				name: 'Wall sit',
				image: '/exercises/wall-sit.jpg',
				sets: '3',
				reps: '30-45 s',
				rest: '60 s',
				cues: ['Rodillas a 90 grados', 'Espalda pegada a la pared'],
				easyVariant: 'Manten 20 s',
				hardVariant: 'Sujeta una mochila en el pecho',
			},
		],
	},
	{
		id: 'empuje',
		title: 'Empuje (pecho, hombro, triceps)',
		description: 'Trabajo de empuje para la parte superior.',
		exercises: [
			{
				id: 'empuje-flexiones',
				name: 'Flexiones',
				image: '/exercises/push-up.jpg',
				sets: '3',
				reps: '8-15',
				rest: '60-90 s',
				cues: ['Cuerpo en linea recta', 'Codos a 45 grados'],
				easyVariant: 'Apoya rodillas',
				hardVariant: 'Pies elevados',
			},
			{
				id: 'empuje-flexiones-pica',
				name: 'Flexiones pica (hombros)',
				image: '/exercises/pike-push-up.jpg',
				sets: '3',
				reps: '10',
				rest: '60 s',
				cues: ['Cadera arriba', 'Baja la cabeza entre manos'],
				easyVariant: 'Menos inclinacion',
				hardVariant: 'Pies sobre una silla',
			},
			{
				id: 'empuje-fondos-silla',
				name: 'Fondos en silla',
				image: '/exercises/chair-dip.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Hombros atras', 'Baja hasta 90 grados'],
				easyVariant: 'Rodillas flexionadas',
				hardVariant: 'Piernas estiradas',
			},
		],
	},
	{
		id: 'tiron',
		title: 'Tiron (espalda, biceps)',
		description: 'Compensa el empuje y activa la espalda.',
		exercises: [
			{
				id: 'tiron-remo-mochila',
				name: 'Remo con mochila',
				image: '/exercises/backpack-row.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Espalda recta', 'Codos cerca del torso'],
				easyVariant: 'Menos peso en la mochila',
				hardVariant: 'Pausa 1 s arriba',
			},
			{
				id: 'tiron-curl-biceps',
				name: 'Curl biceps con mochila/garrafas',
				image: '/exercises/backpack-curl.jpg',
				sets: '3',
				reps: '12',
				rest: '60 s',
				cues: ['Codos fijos', 'Controla la bajada'],
				easyVariant: 'Menos peso',
				hardVariant: 'Subida de 3 s',
			},
		],
	},
	{
		id: 'core',
		title: 'Core (abdominales)',
		description: 'Estabilidad y control del tronco.',
		exercises: [
			{
				id: 'core-plancha',
				name: 'Plancha',
				image: '/exercises/plank.jpg',
				sets: '3',
				reps: '30-45 s',
				rest: '45 s',
				cues: ['Abdomen activo', 'Cadera alineada'],
				easyVariant: 'Apoya rodillas',
				hardVariant: 'Eleva una pierna',
			},
			{
				id: 'core-crunch',
				name: 'Crunch',
				image: '/exercises/crunch.jpg',
				sets: '3',
				reps: '15',
				rest: '30 s',
				cues: ['No jales el cuello', 'Exhala al subir'],
				easyVariant: 'Menos rango',
				hardVariant: 'Pausa 1 s arriba',
			},
			{
				id: 'core-elevaciones-piernas',
				name: 'Elevaciones de piernas',
				image: '/exercises/leg-raise.jpg',
				sets: '3',
				reps: '12',
				rest: '45 s',
				cues: ['Espalda baja pegada', 'Baja lento'],
				easyVariant: 'Rodillas flexionadas',
				hardVariant: 'Anade tobilleras',
			},
		],
	},
	{
		id: 'finisher',
		title: 'Finisher (opcional)',
		description: 'Cierra con cardio y potencia.',
		exercises: [
			{
				id: 'finisher-mountain-climbers',
				name: 'Mountain climbers',
				image: '/exercises/mountain-climber.jpg',
				sets: '3',
				reps: '30 s',
				rest: '30 s',
				cues: ['Ritmo constante', 'Cadera estable'],
				easyVariant: 'Ritmo lento',
				hardVariant: 'Sprint final de 10 s',
			},
			{
				id: 'finisher-jumping-jacks',
				name: 'Jumping Jacks',
				image: '/exercises/jumping-jack.jpg',
				sets: '3',
				reps: '30 s',
				rest: '20 s',
				cues: ['Respira profundo', 'Aterriza suave'],
			},
		],
	},
];

const routineSummary = routineSections.map((section) => ({
	id: section.id,
	title: section.title,
	count: section.exercises.length,
}));

const totalExercises = routineSections.reduce((sum, section) => sum + section.exercises.length, 0);
---

<!doctype html>
<html lang="es">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body class="routine-body">
		<Header />
		<main class="routine">
			<section class="routine-hero">
				<p class="routine-hero__badge">Rutina full body en casa</p>
				<h1>Entrena todo el cuerpo con peso corporal y mochila</h1>
				<p>
					Una rutina completa, clara y progresiva para entrenar en casa. Ajusta el descanso segun tu nivel y
					manten una tecnica limpia en cada repeticion.
				</p>
				<div class="routine-hero__chips">
					<span>45-60 min</span>
					<span>Sin gimnasio</span>
					<span>Material opcional</span>
				</div>
			</section>

			<section class="routine-overview">
				<div class="routine-overview__card">
					<h2>Como usar la rutina</h2>
					<ul>
						<li>Haz el calentamiento completo antes de empezar.</li>
						<li>Descansa 1-2 min entre secciones si lo necesitas.</li>
						<li>Prioriza la tecnica sobre la velocidad.</li>
					</ul>
				</div>
				<nav class="routine-overview__nav" aria-label="Indice de secciones">
					<h2>Secciones</h2>
					<div class="routine-overview__links">
						{routineSummary.map((item) => (
							<a href={`#${item.id}`}>
								<span>{item.title}</span>
								<em>{item.count} ejercicios</em>
							</a>
						))}
					</div>
				</nav>
			</section>

			<section class="routine-progress" aria-live="polite">
				<div>
					<h2>Progreso de hoy</h2>
					<p>
						<span data-progress-count>0</span> / <span data-progress-total>{totalExercises}</span> ejercicios
						completados
					</p>
				</div>
				<div class="routine-progress__bar">
					<div class="routine-progress__fill" data-progress-fill></div>
				</div>
				<button class="routine-progress__reset" type="button" data-reset-today>Reset de hoy</button>
			</section>

			<section class="routine-info">
				<div class="routine-info__card">
					<h2>Equipo y espacio</h2>
					<p>Necesitas una silla estable, una mochila con peso y una colchoneta.</p>
					<ul>
						<li>Mochila: libros o botellas para ajustar carga.</li>
						<li>Espacio: 2x2 metros libres.</li>
						<li>Suelo antideslizante para seguridad.</li>
					</ul>
				</div>
				<div class="routine-info__card">
					<h2>Frecuencia sugerida</h2>
					<p>Haz esta rutina 2-4 veces por semana segun tu nivel.</p>
					<ul>
						<li>Principiante: 2 dias con 1 dia de descanso.</li>
						<li>Intermedio: 3 dias alternos.</li>
						<li>Avanzado: 4 dias con intensidad moderada.</li>
					</ul>
				</div>
				<div class="routine-info__card">
					<h2>Cierre y estiramiento</h2>
					<p>Dedica 5-8 minutos a bajar pulsaciones y estirar.</p>
					<ul>
						<li>Respiracion profunda y lenta.</li>
						<li>Estira piernas, pecho y espalda.</li>
						<li>Hidrata y registra tu progreso.</li>
					</ul>
				</div>
			</section>

			<div class="routine-sections">
				{routineSections.map((section) => (
					<Section
						id={section.id}
						title={section.title}
						description={section.description}
						count={section.exercises.length}
					>
						{section.exercises.map((exercise, index) => (
							<ExerciseCard
								{...exercise}
								order={index + 1}
								sectionId={section.id}
								restSeconds={getDefaultRest(exercise.rest)}
							/>
						))}
					</Section>
				))}
			</div>
		</main>
		<button class="floating-button" type="button" data-sections-toggle aria-expanded="false">
			Secciones
		</button>
		<div class="floating-panel" data-sections-panel hidden>
			<h3>Ir a seccion</h3>
			<nav>
				{routineSummary.map((item) => (
					<a href={`#${item.id}`}>{item.title}</a>
				))}
			</nav>
		</div>
		<div class="floating-overlay" data-sections-overlay></div>
		<button class="back-to-top" type="button" data-back-to-top aria-label="Volver arriba">
			Arriba
		</button>
		<Footer />
		<RoutineClient />
	</body>
</html>

<style>
	:global(body.routine-body) {
		background: radial-gradient(circle at top, #1f2a44 0%, #0b0e14 55%, #070a10 100%);
		color: #e2e8f0;
	}

	:global(body.routine-body main) {
		width: min(1100px, calc(100% - 2.5rem));
	}

	.routine {
		padding: 3.5rem 0 4rem;
		display: grid;
		gap: 3rem;
	}

	.routine-hero {
		display: grid;
		gap: 1rem;
		background: linear-gradient(135deg, rgba(23, 32, 50, 0.95), rgba(8, 11, 18, 0.95));
		border-radius: 24px;
		padding: 2.5rem;
		border: 1px solid rgba(148, 163, 184, 0.2);
		box-shadow: 0 30px 70px rgba(5, 8, 15, 0.55);
		position: relative;
		overflow: hidden;
	}

	.routine-hero::after {
		content: '';
		position: absolute;
		inset: 0;
		background:
			radial-gradient(circle at top right, rgba(250, 204, 21, 0.08), transparent 55%),
			radial-gradient(circle at 20% 20%, rgba(56, 189, 248, 0.08), transparent 60%);
		pointer-events: none;
	}

	.routine-hero__badge {
		display: inline-flex;
		align-items: center;
		gap: 0.5rem;
		background: rgba(250, 204, 21, 0.15);
		color: #facc15;
		padding: 0.35rem 0.85rem;
		border-radius: 999px;
		font-size: 0.85rem;
		text-transform: uppercase;
		letter-spacing: 0.08em;
		margin: 0;
	}

	.routine-hero h1 {
		font-size: clamp(2.1rem, 3vw, 3rem);
		margin: 0;
		color: #f8fafc;
	}

	.routine-hero p {
		margin: 0;
		color: rgba(226, 232, 240, 0.82);
		font-size: 1.05rem;
		max-width: 60ch;
	}

	.routine-hero__chips {
		display: flex;
		flex-wrap: wrap;
		gap: 0.75rem;
	}

	.routine-hero__chips span {
		background: rgba(15, 23, 42, 0.7);
		border: 1px solid rgba(148, 163, 184, 0.2);
		padding: 0.4rem 0.9rem;
		border-radius: 999px;
		font-size: 0.9rem;
	}

	.routine-overview {
		display: grid;
		grid-template-columns: repeat(2, minmax(0, 1fr));
		gap: 1.5rem;
	}

	.routine-overview__card,
	.routine-overview__nav {
		background: rgba(12, 16, 24, 0.8);
		border: 1px solid rgba(148, 163, 184, 0.18);
		border-radius: 20px;
		padding: 1.75rem;
		display: grid;
		gap: 1rem;
	}

	.routine-overview h2 {
		margin: 0;
		font-size: 1.4rem;
		color: #f8fafc;
	}

	.routine-overview ul {
		margin: 0;
		padding-left: 1.2rem;
		color: rgba(226, 232, 240, 0.8);
		display: grid;
		gap: 0.5rem;
	}

	.routine-overview__links {
		display: grid;
		gap: 0.75rem;
	}

	.routine-overview__links a {
		display: flex;
		justify-content: space-between;
		align-items: center;
		gap: 1rem;
		padding: 0.75rem 1rem;
		border-radius: 14px;
		background: rgba(15, 23, 42, 0.6);
		border: 1px solid rgba(148, 163, 184, 0.15);
		text-decoration: none;
		color: #e2e8f0;
		transition: transform 0.2s ease, border-color 0.2s ease, background 0.2s ease;
	}

	.routine-overview__links a:hover {
		transform: translateY(-2px);
		border-color: rgba(250, 204, 21, 0.5);
		background: rgba(15, 23, 42, 0.85);
	}

	.routine-overview__links em {
		font-style: normal;
		color: rgba(226, 232, 240, 0.6);
		font-size: 0.9rem;
	}

	.routine-progress {
		display: grid;
		grid-template-columns: minmax(0, 1fr) minmax(0, 2fr) auto;
		align-items: center;
		gap: 1.5rem;
		background: rgba(12, 16, 24, 0.8);
		border: 1px solid rgba(148, 163, 184, 0.18);
		border-radius: 20px;
		padding: 1.5rem 1.75rem;
	}

	.routine-progress h2 {
		margin: 0 0 0.35rem;
		font-size: 1.4rem;
		color: #f8fafc;
	}

	.routine-progress p {
		margin: 0;
		color: rgba(226, 232, 240, 0.7);
		font-size: 0.95rem;
	}

	.routine-progress__bar {
		position: relative;
		height: 10px;
		background: rgba(15, 23, 42, 0.6);
		border-radius: 999px;
		overflow: hidden;
	}

	.routine-progress__fill {
		position: absolute;
		inset: 0;
		width: 0%;
		background: linear-gradient(90deg, rgba(250, 204, 21, 0.9), rgba(34, 197, 94, 0.9));
		transition: width 0.3s ease;
	}

	.routine-progress__reset {
		background: transparent;
		border: 1px solid rgba(148, 163, 184, 0.35);
		color: rgba(226, 232, 240, 0.8);
		padding: 0.55rem 1rem;
		border-radius: 999px;
		cursor: pointer;
	}

	.routine-progress__reset:focus-visible {
		outline: 2px solid #facc15;
		outline-offset: 2px;
	}

	.routine-info {
		display: grid;
		grid-template-columns: repeat(3, minmax(0, 1fr));
		gap: 1.5rem;
	}

	.routine-info__card {
		background: rgba(12, 16, 24, 0.8);
		border: 1px solid rgba(148, 163, 184, 0.18);
		border-radius: 20px;
		padding: 1.6rem;
		display: grid;
		gap: 0.75rem;
	}

	.routine-info__card h2 {
		margin: 0;
		font-size: 1.2rem;
		color: #f8fafc;
	}

	.routine-info__card p {
		margin: 0;
		color: rgba(226, 232, 240, 0.7);
		font-size: 0.95rem;
	}

	.routine-info__card ul {
		margin: 0;
		padding-left: 1.1rem;
		color: rgba(226, 232, 240, 0.78);
		display: grid;
		gap: 0.35rem;
		font-size: 0.95rem;
	}

	.routine-sections {
		display: grid;
		gap: 3rem;
	}

	:global(body.routine-body a) {
		color: #facc15;
	}

	:global(body.routine-body button) {
		font-family: inherit;
	}

	:global(body.routine-body a:focus-visible),
	:global(body.routine-body button:focus-visible),
	:global(body.routine-body input:focus-visible) {
		outline: 2px solid #facc15;
		outline-offset: 2px;
	}

	:global(body.routine-body .exercise-card) {
		animation: rise 0.6s ease both;
	}

	@keyframes rise {
		from {
			opacity: 0;
			transform: translateY(16px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	@media (prefers-reduced-motion: reduce) {
		:global(body.routine-body .exercise-card) {
			animation: none;
		}
	}

	@media (max-width: 720px) {
		.routine-hero {
			padding: 1.75rem;
		}

		.routine-overview {
			grid-template-columns: 1fr;
		}

		.routine-progress {
			grid-template-columns: 1fr;
			gap: 1rem;
		}

		.routine-info {
			grid-template-columns: 1fr;
		}
	}

	.floating-button {
		position: fixed;
		bottom: 1.5rem;
		left: 1.5rem;
		background: rgba(15, 23, 42, 0.9);
		color: #f8fafc;
		border: 1px solid rgba(148, 163, 184, 0.3);
		padding: 0.65rem 1rem;
		border-radius: 999px;
		display: none;
		z-index: 20;
	}

	.floating-panel {
		position: fixed;
		bottom: 4.5rem;
		left: 1.5rem;
		background: rgba(8, 12, 20, 0.98);
		border: 1px solid rgba(148, 163, 184, 0.3);
		border-radius: 16px;
		padding: 1rem;
		width: min(260px, calc(100vw - 3rem));
		display: grid;
		gap: 0.75rem;
		z-index: 20;
	}

	.floating-panel h3 {
		margin: 0;
		font-size: 1rem;
		color: #f8fafc;
	}

	.floating-panel nav {
		display: grid;
		gap: 0.5rem;
	}

	.floating-panel a {
		text-decoration: none;
		color: rgba(226, 232, 240, 0.8);
		padding: 0.4rem 0.5rem;
		border-radius: 10px;
		background: rgba(15, 23, 42, 0.6);
	}

	.floating-panel a:hover {
		color: #facc15;
	}

	.floating-overlay {
		position: fixed;
		inset: 0;
		background: rgba(0, 0, 0, 0.5);
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease;
		z-index: 15;
	}

	.floating-overlay.is-open {
		opacity: 1;
		pointer-events: auto;
	}

	.floating-panel.is-open {
		display: grid;
	}

	.back-to-top {
		position: fixed;
		right: 1.5rem;
		bottom: 1.5rem;
		background: #facc15;
		color: #0b0e14;
		border: none;
		padding: 0.6rem 0.9rem;
		border-radius: 999px;
		font-weight: 600;
		cursor: pointer;
		opacity: 0;
		pointer-events: none;
		transition: opacity 0.2s ease, transform 0.2s ease;
		z-index: 20;
	}

	.back-to-top.is-visible {
		opacity: 1;
		pointer-events: auto;
		transform: translateY(-4px);
	}

	@media (max-width: 960px) {
		.floating-button {
			display: inline-flex;
		}
	}
</style>
